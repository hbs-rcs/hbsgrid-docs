
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Dev-ops Docs &#8212; HBS Grid Software Environment Technology Preview  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Deployment on the HBS Grid" href="hbsgrid.html" />
    <link rel="prev" title="User Guide" href="quickstart.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">HBS Grid Software Environment Technology Preview</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Dev-ops Docs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-approach">General approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#environment-creation-and-software-installation">Environment creation and software installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modulefiles-and-launchers">Modulefiles and Launchers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#desktop-menu-desktop-files">Desktop Menu (.desktop) Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#activation-and-startup">Activation and startup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#updates-and-new-environments">Updates and new environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-the-documentation">Building the documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hbsgrid.html">Deployment on the HBS Grid</a></li>
<li class="toctree-l1"><a class="reference internal" href="fun.html">Just for fun</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="quickstart.html" title="previous chapter">User Guide</a></li>
      <li>Next: <a href="hbsgrid.html" title="next chapter">Deployment on the HBS Grid</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="dev-ops-docs">
<h1>Dev-ops Docs<a class="headerlink" href="#dev-ops-docs" title="Permalink to this headline">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>Ista Zahn</p>
</dd>
<dt class="field-even">Date</dt>
<dd class="field-even"><p>2021-03-03</p>
</dd>
</dl>
<p>RCS provides <strong>Technology Preveiew</strong> software on the HBS Grid. Most
of this software is installed using the <a class="reference external" href="https://docs.conda.io/en/latest/">conda</a>
package manager, with additional ad hoc installations of software not available via conda.
This section of the documentation describes how these environments were
created and how other software was installed and configured. The intended
audience is developers and system administrators who need to install, fix, or
improve these environments. <strong>Users should instead refer to the</strong>
<a class="reference external" href="../../userguide/html/">User Guide</a>.</p>
<section id="general-approach">
<h2>General approach<a class="headerlink" href="#general-approach" title="Permalink to this headline">¶</a></h2>
<p>We have used the Conda package manager, and ad hoc installation
of additional software to constitute modern data science and productivity software stacks.
The heaving lifting is done by <em>conda</em>, with locally built software filling
in the gaps.</p>
<p>The conda environments are named <em>rcs_&lt;date&gt;.&lt;version&gt;</em>. The basic idea here is that when we
update the system we just create a new conda environment and increment the <em>&lt;version&gt;</em> number.
This allows users to continue using or fall back to old environments for convenience or reproducibility
reasons, while providing up-to-date software stacks for new projects. Because conda using a number
of strategies to avoid duplication, new environments usually require relatively little storage space
(though of course this depends on how much has changed relative to existing environments).</p>
<p>The conda-forge ecosystem is large and active, but there are still some programs that are not available
there. In that case we either install pre-built binaries directly from upstream projects, or build and
install it locally. An ongoing goal is to move as much as
possible into conda in order to take advantage of automatic updates, package de-duplication, and other
features provided by the conda ecosystem.</p>
<p>This project also provides launcher scripts and desktop files providing GUIs to start interactive LSF jobs on
a computing cluster. The core idea is to make working on a computing cluster feel more intuitive my
leveraging the “desktop” metaphor and workflows that many people are already comfortable with. For example,
the launchers and desktop files provided by this project enable users to launch a Stata job in LSF by double
clicking on a <em>.do</em> file in the file browser.</p>
</section>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>The <strong>build requirements</strong> on the host system are easily available on most Linux distributions.
They are:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.gnu.org/software/make/">make</a></p></li>
<li><p><a class="reference external" href="https://www.gnu.org/software/coreutils/">coreutils</a></p></li>
<li><p><a class="reference external" href="https://www.freedesktop.org/wiki/Software/xdg-utils/">xdg-utils</a> ,</p></li>
<li><p><a class="reference external" href="https://git-scm.com/">git</a></p></li>
<li><p><a class="reference external" href="http://www.gnu.org/software/findutils/">findutils</a></p></li>
<li><p><a class="reference external" href="http://www.gnu.org/software/bc/">bc</a></p></li>
<li><p><a class="reference external" href="https://www.gnu.org/software/bash/">bash</a></p></li>
<li><p><a class="reference external" href="http://www.gnu.org/software/cpio/">cpio</a></p></li>
<li><p><a class="reference external" href="http://www.x.org">mkfontdir</a></p></li>
<li><p><a class="reference external" href="http://freedesktop.org/Software/shared-mime-info">shared-mime-info</a></p></li>
<li><p><a class="reference external" href="https://wiki.gnome.org/Projects/dconf">dconf</a></p></li>
<li><p><a class="reference external" href="http://www.rpm.org/">rpm2cpio</a> or <a class="reference external" href="https://github.com/dowjones/rpm-extract">rmpextract</a></p></li>
<li><p><a class="reference external" href="https://www.gnu.org/software/wget/">wget</a></p></li>
</ul>
<p>These build dependencies can generally be installed using your Linux distribution package manager.
For example, on Fedora use</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dnf install cpio rpm make dconf bc xdg-utils bash <span class="se">\</span>
    wget shared-mime-info xorg-x11-font-utils
</pre></div>
</div>
<p>Everything else should be bootstrapped and built using conda environments.</p>
<p>Additional dependencies are needed to build the documentation, namely
<a class="reference external" href="https://www.sphinx-doc.org/en/master/">sphinx</a> and <a class="reference external" href="http://projectmallard.org/">mallard</a>.</p>
<p>Run-time dependencies additionally include
<a class="reference external" href="https://www.ibm.com/support/knowledgecenter/SSWRJV_10.1.0/lsf_welcome/lsf_welcome.html">LSF</a> and
<a class="reference external" href="https://www.gnome.org/">GNOME 3</a>. We are interested in generalizing this to work with other
schedulers and /or desktop environments, but this has not yet been attempted. User namespaces must be enabled; on older Linux distributions you may need to turn them on. A good set of instructions for doing this is available at <a class="reference external" href="https://sylabs.io/guides/3.8/admin-guide/user_namespace.html">https://sylabs.io/guides/3.8/admin-guide/user_namespace.html</a></p>
<p>A few things will only work correctly on
<a class="reference external" href="https://www.redhat.com/en/technologies/linux-platforms/enterprise-linux">RHEL 7</a>, e.g., the
version of RStudio installed is the one built for RHEL 7. It would be good to fully support running on
other host operating systems. That probably isn’t too hard (there are only a few os-specific binaries involved)
but this has not yet been attempted.</p>
</section>
<section id="environment-creation-and-software-installation">
<h2>Environment creation and software installation<a class="headerlink" href="#environment-creation-and-software-installation" title="Permalink to this headline">¶</a></h2>
<p>NOTE: An installation of this software has been set up on the HBS Grid, so you may not need to set it up again.
(See the <a class="reference external" href="https://code.harvard.edu/pages/HBS/rcs__cluster_software_modules/userguide/html/">user guide</a>
if you want to try it out.)</p>
<p>If you want to install somewhere else, there is
a <em>Makefile</em> in the top-level directory that you can run to (re) install the
software and set up environments. Note that the <code class="docutils literal notranslate"><span class="pre">GRID_EXP_ROOTDIR</span></code> variable will
by used as the root installation directory. It defaults to <code class="docutils literal notranslate"><span class="pre">/opt/gridpowered</span></code>
but you can set it when you call <code class="docutils literal notranslate"><span class="pre">make</span></code>, e.g., <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span> <span class="pre">GRID_EXP_ROOTDIR=/opt/gridpowered</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">scripts</span></code> directory contains in installation and configuration code. Generally you should
run this code using <code class="docutils literal notranslate"><span class="pre">make</span></code> from the top-level directory rather than executing the scripts
directly. There are three types of scripts, as indicated by the file name prefix or suffix:</p>
<dl class="simple">
<dt>conda prefix</dt><dd><p>Files starting with <code class="docutils literal notranslate"><span class="pre">conda_.sh</span></code> install and configure conda environments.</p>
</dd>
<dt>build prefix</dt><dd><p>Files starting with <code class="docutils literal notranslate"><span class="pre">build_</span></code> build and install additional software not
available via conda. These are installed in the <code class="docutils literal notranslate"><span class="pre">local</span></code> directory
under the active <code class="docutils literal notranslate"><span class="pre">conda</span></code> environment.</p>
</dd>
<dt>install prefix</dt><dd><p>Files starting with <code class="docutils literal notranslate"><span class="pre">install_</span></code> install additional pre-compiled binaries
not available via conda. These are installed into the <cite>opt</cite> sub-directory
under the top-level installation directory, and are not environment-specific.</p>
</dd>
<dt>make prefix</dt><dd><p>Files starting with <code class="docutils literal notranslate"><span class="pre">make_</span></code> are used to generate scripts, modulefiles, and desktop files.
These generally are environment-specific and installed in the <code class="docutils literal notranslate"><span class="pre">local</span></code> directory
under the active <code class="docutils literal notranslate"><span class="pre">conda</span></code> environment.</p>
</dd>
</dl>
</section>
<section id="modulefiles-and-launchers">
<h2>Modulefiles and Launchers<a class="headerlink" href="#modulefiles-and-launchers" title="Permalink to this headline">¶</a></h2>
<p>LMOD modulefiles for the data science software environments
installed using the <a class="reference external" href="https://docs.conda.io/en/latest/">conda</a>
package manager are generated from the <code class="docutils literal notranslate"><span class="pre">scripts/make_modulefiles.sh</span></code> script.</p>
<p>Graphical applications ran be launched from the HBS Grid desktop using the
launcher scripts and <em>.desktop</em> files built from <code class="docutils literal notranslate"><span class="pre">scripts/make_launchers.sh</span></code>
and <code class="docutils literal notranslate"><span class="pre">scripts/make_desktopfiles.sh</span></code>.</p>
</section>
<section id="desktop-menu-desktop-files">
<h2>Desktop Menu (.desktop) Files<a class="headerlink" href="#desktop-menu-desktop-files" title="Permalink to this headline">¶</a></h2>
<p>There are three sets of desktop files installed. Most importantly, those generated
from <code class="docutils literal notranslate"><span class="pre">scripts/make_desktopfiles.sh</span></code> install menus for launching applications
using bsub via graphical menu launchers.</p>
<p>Additional .desktop files in <code class="docutils literal notranslate"><span class="pre">desktop_mask</span></code> are used to hide “wrapper” and other RCS
menu entries that are to be replaced by those generated from <code class="docutils literal notranslate"><span class="pre">scripts/make_desktopfiles.sh</span></code>.</p>
</section>
<section id="activation-and-startup">
<h2>Activation and startup<a class="headerlink" href="#activation-and-startup" title="Permalink to this headline">¶</a></h2>
<p>Users can opt-in to this environment by running the
<code class="docutils literal notranslate"><span class="pre">bin/grid_set_desktop_mode.sh</span></code>
script. This script initializes some environment variables, adds application and
font symlinks to <code class="docutils literal notranslate"><span class="pre">~/.local</span></code>, and creates a symlink in <code class="docutils literal notranslate"><span class="pre">~/.config/autostart</span></code>.
In particular, <code class="docutils literal notranslate"><span class="pre">share/applications/grid_gnome_modern.desktop</span></code> will be
symlinked to <code class="docutils literal notranslate"><span class="pre">~/.config/autostart</span></code>. This has the effect of setting environment
variables, activating the “rcs_&lt;year&gt;.&lt;version&gt;” conda environment described above and then restarting,
the Gnome desktop so that the desktop environment inherits these environment variables
and conda environments.</p>
<p>The setup process described above results a symlink in <code class="docutils literal notranslate"><span class="pre">~/.local/applications</span></code> linking
to the <code class="docutils literal notranslate"><span class="pre">share/applications/grid_gnome.desktop</span></code> file. This adds
a “HBS Grid Configuration” menu item, making it easy to toggle technology preview features on
and off.</p>
</section>
<section id="updates-and-new-environments">
<h2>Updates and new environments<a class="headerlink" href="#updates-and-new-environments" title="Permalink to this headline">¶</a></h2>
<p>This system is designed to make it easy to create new environments with updated software while leaving
previous environments intact so researchers can fall back to older versions when needed. In general we
encourage you to avoid updating existing environments – just create a new one instead. Because conda
does a bunch of de-duplication you won’t end up using much more in the way of resources, and you’ll reduce
the risk of breaking something in an existing environment.</p>
<p>In our experience a two-step process for releasing new environments has been useful. First, create a development
environment (we usually name ours <em>rcs_0000.99</em>). Do whatever you like in this environment, including breaking
things (temporarily of course!). When you get it working to your satisfaction re-create it with a proper
<em>rcs_&lt;year&gt;.&lt;version&gt;</em> name (and never change it again).</p>
<p>Details about our specific release process on the HBS Grid are available in the HBS Grid Deployment section,
as an example you may wish to follow when deploying elsewhere.</p>
</section>
<section id="building-the-documentation">
<h2>Building the documentation<a class="headerlink" href="#building-the-documentation" title="Permalink to this headline">¶</a></h2>
<p>The devops documentation you are now reading is generated from the
<a class="reference external" href="https://www.sphinx-doc.org/en/master/">sphinx</a> sources in
<code class="docutils literal notranslate"><span class="pre">docs/devops_source</span></code>. The easiest way to update this
documentation is to run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span></code> from the <code class="docutils literal notranslate"><span class="pre">docs/</span></code>
directory.</p>
<p>The User Guide documentation is maintained as
<a class="reference external" href="http://projectmallard.org/">mallard pages</a> in
<code class="docutils literal notranslate"><span class="pre">docs/userguide</span></code>. Mallard was chosen so that we can display
this documentation in Yelp, the Gnome help viewer. HTML versions of the user guide
were generated with <code class="docutils literal notranslate"><span class="pre">yelp</span> <span class="pre">build</span> <span class="pre">html</span></code>; the easiest way to update this
documentation is to run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span></code> from the <code class="docutils literal notranslate"><span class="pre">docs/</span></code>
directory.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;President & Fellows of Harvard College.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/devops.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>