<!-- Determine analytics property -->
{% if config.extra.analytics %}
{% set property = config.extra.analytics.property | d("", true) %}
{% endif %}

<script>
 window.dataLayer = window.dataLayer || []
 function gtag() { dataLayer.push(arguments) }

 /* Set up integration and send page view */
 gtag("js", new Date())
 gtag("config", "{{ property }}", { client_storage: 'none', anonymize_ip: true })

 /* Register event handlers after documented loaded */
 document.addEventListener("DOMContentLoaded", function() {
     if (document.forms.search) {
         var query = document.forms.search.query
         query.addEventListener("blur", function() {
             if (this.value)
                 gtag("event", "search", { search_term: this.value })
         })
     }

     /* Send page view on location change */
     if (typeof location$ !== "undefined")
         location$.subscribe(function(url) {
             gtag("config", "{{ property }}", {
                 page_path: url.pathname. client_storage: 'none', anonymize_ip: true
             })
         })
 })
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id={{ property }}">
</script>
